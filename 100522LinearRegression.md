### Linear Regression Exercise

#### 1. Plot the relationship between age and wing length. 

```
Age = [3;4;5;6;7;8;9;11;12;14;15;16;17];
WingLength = [1.4;1.5;2.2;2.4;3.1;3.2;3.2;3.9;4.1;4.7;4.5;5.2;5];

scatter(Age,WingLength);
title('Plot of Age vs. Wing Length');
xlabel('Age (years)');
ylabel('Wing Length (cm)');
```


![PSet8](https://user-images.githubusercontent.com/112706184/193486721-14af907b-bd9c-4f05-9fc3-45b6297ca0f3.jpg)

#### 2. Calculate and plot the regression line. 

##### Calculate slope:

```
Term1 = 0;
for i = 1:13
    Term1 = Term1 + (Age(i)*WingLength(i));
end


SumAge = 0;
SumWingLength = 0;
for i = 1:13
    SumAge = SumAge + Age(i);
    SumWingLength = SumWingLength + WingLength(i);
end

n = 13;
Term2 = (SumAge * SumWingLength)/n;

Numerator = Term1-Term2;

Term3 = 0;
for i = 1:13
    Term3 = Term3 + ((Age(i))^2);
end

Term4 = ((SumAge)^2)/n;

Denominator = Term3 - Term4;

b = Numerator/Denominator;

fprintf('This yields a slope of b = %f.\n',b)
```
This yields a slope of b = 0.264684.

##### Calculate intercept:

```
WingLengthAvg = mean(WingLength);
AgeAvg = mean(Age);
a = WingLengthAvg - b*AgeAvg;
fprintf('This yields an intercept of a = %f.\n',a)
```
This yields an intercept of a = 0.829624.

I checked these results using the function fitlm and it yielded the same numbers. 

```
fitlm(Age,WingLength,"linear");
```


##### Plot line: 

```
scatter(Age,WingLength);
title('Plot of Age vs. Wing Length');
xlabel('Age (years)');
ylabel('Wing Length (cm)');
hold on
refline(b,a);
```

Yields the following graph: 

![PSet8](https://user-images.githubusercontent.com/112706184/193488198-d64045cc-d959-4be6-9000-2389678c13a8.jpg)

#### 3. Can you reject H0: b = 0? 
Use fitlm function to compute standard error of the slope b: 

```
LinReg = fitlm(Age,WingLength,"linear");
SEb = LinReg.Coefficients{2,2}; %call standard error of the slope from this analysis
t = b/SEb; %find value in t distribution corresponding to the slope and its standard error
df = n - 2;
p = tcdf(t,df,"upper")*2; %use T distribution CDF to compute 2-tailed p-value. 
fprintf('p = %d.\n',p)
```
p = 3.009743e-09.

Based on this p value, we can reject the null hypothesis that b = 0. 

#### 4. Calculate and plot confidence intervals on the slope of the regression. 

Use formula from tutorial to compute 95% CI: 

```
Denom = 0;
for i = 1:13
    Denom = Denom + ((Age(i) - AgeAvg)^2);
end
CI95Upper = b + tinv(0.975,n-2) * sqrt((LinReg.MSE)/Denom);
CI95Lower = b + tinv(0.025,n-2) * sqrt((LinReg.MSE)/Denom);
fprintf('95%% CI [%f,%f].\n',CI95Lower,CI95Upper)
```

This yields: 95% CI [0.230439,0.298929].

To plot this confidence interval on the regression slope, we need to compute 95% CI of wing length at each theoretical value of age in a range including our data. We hold on the graph generated by the previous code above and superimpose the confidence intervals on the slope. 

```
AgeTheoretical = [2:0.1:18]';
WingLength95Upper = AgeTheoretical*CI95Upper + a;
WingLength95Lower = AgeTheoretical*CI95Lower + a;
hold on
coord_up = [AgeTheoretical,WingLength95Upper];
coord_low = [AgeTheoretical,WingLength95Lower];
coord_combine = [coord_up;flipud(coord_low)];
fill(coord_combine(:,1),coord_combine(:,2),'b','FaceAlpha',0.25)
```

This generates the following plot: 

![pset8ci](https://user-images.githubusercontent.com/112706184/193494106-8f41c1e5-6d4c-44bd-8e15-8e410975fde0.jpg)

#### 5. Calculate R<sup>2</sup> (coefficient of determination)

Since this is not a multiple regression but just linear regression, R<sup>2</sup> = r<sup>2</sup> = correlation coefficient squared. 

```
R = corrcoef(Age,WingLength); %compute correlation coefficient
Rsquared = (R(1,2))^2; %square it
fprintf('Rsquared = %f.\n',Rsquared)
```

Rsquared = 0.963382.

This corresponds to the value generated by fitlm function in MATLAB.

#### 6. Calculate Pearson's r.

As above: 

```
R = corrcoef(Age,WingLength); %compute correlation coefficient
fprintf('Pearson''s r = %f.\n',R(1,2))
```

Can also be done using formulae: 

```
n = 13;
x = Age;
y = WingLength;
xbar = mean(x);
ybar = mean(y);
Numerator = 0;
Denomx = 0;
Denomy = 0;
for i = 1:n
    Numerator = Numerator + ((x(i,1) - xbar)* (y(i,1) - ybar));
    Denomx = Denomx + ((x(i,1)-xbar)^2); 
    Denomy = Denomy + ((y(i,1)-ybar)^2); 
end

Denominator = sqrt(Denomx*Denomy);
rXY = Numerator/Denominator;
fprintf('Pearson''s r using equation = %f\n',rXY)
```

Pearson's r using equation = 0.981520.

#### 7. Add some noise to the data and see how the regression changes. 

I will add some noise randomly drawn from a Gaussian with mu = 0, sigma = 1 and add it to Wing Length.

```
Noise = normrnd(0,1,n,1);
NoisyWingLength = WingLength + Noise;
```

I will use fitlm instead of going through the whole formula to compute slope and intercept. 

```
NoisyLinReg = fitlm(Age,NoisyWingLength,"linear");
fprintf('This yields a slope b = %f with p value p = %f.\n',NoisyLinReg.Coefficients{"x1","Estimate"},NoisyLinReg.Coefficients{"x1","pValue"})
```

This yields a slope b = 0.263143 with p value p = 0.006851.

I will superimpose plots of the noisy regression on top of the previous one. 

```
%Compute CI of Noisyb
Noisyb = NoisyLinReg.Coefficients{"x1","Estimate"};
Noisya = NoisyLinReg.Coefficients{"(Intercept)","Estimate"};
NoisySEb = NoisyLinReg.Coefficients{"x1","SE"};
Denom = 0;
for i = 1:13
    Denom = Denom + ((Age(i) - AgeAvg)^2);
end
NoisyCI95Upper = Noisyb + tinv(0.975,n-2) * sqrt((NoisyLinReg.MSE)/Denom);
NoisyCI95Lower = Noisyb + tinv(0.025,n-2) * sqrt((NoisyLinReg.MSE)/Denom);

%For every value of Age, compute the confidence interval of Noisy Wing Length
AgeTheoretical = [2:0.1:18]';
NoisyWingLength95Upper = AgeTheoretical*NoisyCI95Upper + Noisya;
NoisyWingLength95Lower = AgeTheoretical*NoisyCI95Lower + Noisya;

%plot
hold off
scatter(Age,WingLength,"red");
title('Plot of Age vs. Wing Length (red) or Noisy Wing Length (blue)');
xlabel('Age (years)');
ylabel('Wing Length (cm)');
hold on
cleanregline = refline(b,a);
cleanregline.Color = 'r';
plot(AgeTheoretical,WingLength95Upper,':','Color','r');
plot(AgeTheoretical,WingLength95Lower,':','Color','r');
hold on
scatter(Age,NoisyWingLength,"blue");
cleanregline = refline(Noisyb,Noisya);
cleanregline.Color = 'b';
plot(AgeTheoretical,NoisyWingLength95Upper,':','Color','b');
plot(AgeTheoretical,NoisyWingLength95Lower,':','Color','b');
```

This generates the following plot (different on each instance depending on noise): 

![PSet8noise](https://user-images.githubusercontent.com/112706184/193497678-7b408a12-5584-469c-a455-4b9374b69ce8.jpg)
